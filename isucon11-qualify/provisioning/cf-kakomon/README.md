# cf-kakomon

isucon11 予選の過去問環境を AWS 上に構築するための CloudFormation ファイルが配置されています。

## 利用手順

1. 事前に EC2 KeyPair の作成してください
2. CloudFormation より cf.yaml を利用してスタックを作成してください
    * パラメータに手順1で作成した KeyPair 名を指定
3. CloudFormation により作成される EC2 インスタンスには、手順1で作成した秘密鍵を利用して `ubuntu` ユーザでログイン可能です

## ベンチ実行手順

ベンチマーカインスタンスにログインした後 `isucon` ユーザで以下のコマンドを実行することでベンチマーカを実行可能です。

```
cd ~/bench
./bench -tls -target=192.168.0.11 -all-addresses=192.168.0.11,192.168.0.12,192.168.0.13 -jia-service-url http://192.168.0.10:5000
```

## ブラウザでのアクセスにおける留意点

過去問環境において競技用インスタンスで動作している isucondition にブラウザからアクセスする際の留意点です。

### ログイン

「JIAのアカウントでログイン」を押すと http://localhost:5000 に遷移するようになっています。
このアクセスは競技用サーバ上で動作する `jiaapi-mock.service` が受ける想定です。

以下のコマンドより localhost:5000 が競技用サーバ上の 5000 番ポートにローカルフォワードされるようにした上でブラウザ操作を行ってください。

```
ssh isucon@<競技用サーバのグローバルアドレス> -L 5000:localhost:5000
```

### ISU の登録

ブラウザより ISU の登録を行う際にも JIA API Mock が必要です。
こちらについては [アプリケーションマニュアル](../../docs/isucondition.md) をご確認ください。
